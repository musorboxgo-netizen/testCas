<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title th:text="#{cas.mfa.inalogy.auth.pagetitle.pushwaiting}">Inalogy Push Authentication - Waiting</title>
    <link href="../../static/css/cas.css" rel="stylesheet" th:remove="tag" />
    <style>
        .push-wait-animation {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1.5em;
        }
        .circle-loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #009688;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 1.2s linear infinite;
        }
        @keyframes spin {
            0%   { transform: rotate(0deg);}
            100% { transform: rotate(360deg);}
        }
        .phone-img {
            width: 48px;
            margin-top: 0.7em;
            opacity: 0.85;
            animation: pulse 1.8s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1);}
            50% { transform: scale(1.08);}
            100% { transform: scale(1);}
        }
    </style>
</head>

<body id="cas">
<main class="container mt-3 mb-3">
    <div layout:fragment="content" id="push-wait" class="mdc-card card p-4 m-auto w-lg-66 text-center">
        <h2 th:text="#{cas.mfa.inalogy.auth.pagetitle.pushwaiting}">Waiting for Push Confirmation…</h2>
        <div class="push-wait-animation">
            <div class="circle-loader"></div>
            <!-- Любая динамическая svg-картинка телефона, например: -->
            <svg class="phone-img" viewBox="0 0 24 24" fill="none">
                <rect x="5" y="2" width="14" height="20" rx="3" fill="#009688"/>
                <rect x="8" y="5" width="8" height="14" rx="1" fill="#fff"/>
                <circle cx="12" cy="19" r="1" fill="#bbb"/>
            </svg>
        </div>
        <p th:utext="#{cas.mfa.inalogy.auth.pushwaiting}">
            Please approve the login on your registered device.<br>
            Waiting for your confirmation…
        </p>
        <p class="text-muted small mt-3">
            <span th:text="#{cas.mfa.inalogy.auth.pushwaiting.tip}">
                Didn’t receive a notification? Make sure your phone is online and notifications are enabled.
            </span>
        </p>
        <!-- Опционально: кнопка отмены -->
        <form th:action="@{/login}" method="get" class="mt-3">
            <button type="submit" class="mdc-button mdc-button--outlined">
                <span class="mdc-button__label" th:text="#{cas.mfa.inalogy.auth.cancel}">Cancel</span>
            </button>
        </form>
    </div>
</main>

<script th:inline="javascript">
    // Flag to track if check is in progress
    var checkInProgress = false;

    // Function to reload the page to check push status
    function checkPushStatus() {
        if (checkInProgress) {
            return; // Prevent multiple simultaneous reloads
        }

        checkInProgress = true;
        window.location.reload();
    }

    // Check status every 2 seconds
    var checkStatusInterval = setInterval(function() {
        checkPushStatus();
    }, 2000);

    // Stop checking after 1 minute (timeout value in InalogyPushCheckResponseAction)
    setTimeout(function() {
        clearInterval(checkStatusInterval);
    }, 60000);
</script>

</body>
</html>
